{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "isNidVerified": {
          "type": "boolean",
          "description": "Whether the user's NID is verified."
        },
        "nidApplicationPending": {
          "type": "boolean",
          "description": "Whether the user has a pending NID verification application."
        },
        "nidName": {
          "type": "string",
          "description": "Name as per NID."
        },
        "nidNumber": {
          "type": "string",
          "description": "NID card number."
        },
        "nidDob": {
          "type": "string",
          "description": "Date of birth from NID.",
          "format": "date"
        },
        "nidAddress": {
          "type": "string",
          "description": "Address as per NID."
        },
        "rewardPoints": {
          "type": "number",
          "description": "User's total reward points."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a user's income entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the income entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Income)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of income."
        },
        "date": {
          "type": "string",
          "description": "Date of income.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of income source."
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "date"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents a user's expense entry.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Expense)"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of expense."
        },
        "date": {
          "type": "string",
          "description": "Date of expense.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of expense."
        }
      },
      "required": [
        "id",
        "userId",
        "categoryId",
        "amount",
        "date"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for expenses.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Category)"
        }
      },
      "required": [
        "id",
        "name",
        "userId"
      ]
    },
    "Budget": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Budget",
      "type": "object",
      "description": "Represents a user's budget.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the budget."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Budget)"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Budget)"
        },
        "amount": {
          "type": "number",
          "description": "Budgeted amount for the category."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the budget.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the budget.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "categoryId",
        "amount",
        "startDate",
        "endDate"
      ]
    },
    "Loan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Loan",
      "type": "object",
      "description": "Represents a loan a user has given or taken.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the loan."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User taking or giving loan. (Relationship: User 1:N Loan)"
        },
        "friendId": {
          "type": "string",
          "description": "Reference to User who is the friend involved in the loan. (Relationship: User 1:N Loan)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the loan."
        },
        "date": {
          "type": "string",
          "description": "Date of the loan.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the loan."
        },
        "loanType": {
          "type": "string",
          "description": "Type of loan ('given' or 'taken')."
        }
      },
      "required": [
        "id",
        "userId",
        "friendId",
        "amount",
        "date",
        "loanType"
      ]
    },
     "CheckIn": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CheckIn",
      "type": "object",
      "description": "Represents a daily check-in record for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the check-in record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CheckIn)"
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The ISO 8601 timestamp of the check-in."
        },
        "points": {
          "type": "number",
          "description": "Points awarded for this check-in."
        }
      },
      "required": ["id", "userId", "date", "points"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the authenticated user can access their own profile. This collection ensures Authorization Independence without relying on get() calls, supporting QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income entries for a specific user. Path-based ownership ensures only the authenticated user can access their own income data. This collection ensures Authorization Independence without relying on get() calls, supporting QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier for the income entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense entries for a specific user. Path-based ownership ensures only the authenticated user can access their own expense data. This collection ensures Authorization Independence without relying on get() calls, supporting QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier for the expense entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores expense categories for a specific user. Path-based ownership ensures only the authenticated user can access their own categories. This collection ensures Authorization Independence without relying on get() calls, supporting QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "categoryId",
              "description": "The unique identifier for the expense category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Stores budget entries for a specific user. Path-based ownership ensures only the authenticated user can access their own budgets. This collection ensures Authorization Independence without relying on get() calls, supporting QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "budgetId",
              "description": "The unique identifier for the budget entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/loans/{loanId}",
        "definition": {
          "entityName": "Loan",
          "schema": {
            "$ref": "#/backend/entities/Loan"
          },
          "description": "Stores loan entries (given or taken) for a specific user. Path-based ownership ensures only the authenticated user can access their own loan data. This collection ensures Authorization Independence without relying on get() calls, supporting QAPs.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "loanId",
              "description": "The unique identifier for the loan entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/checkIns/{checkInId}",
        "definition": {
          "entityName": "CheckIn",
          "schema": {
            "$ref": "#/backend/entities/CheckIn"
          },
          "description": "Stores daily check-in records for a user to track streaks and rewards. Path-based ownership ensures privacy.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "checkInId",
              "description": "The unique identifier for the check-in record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and debuggable, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), QAPs (Rules are not Filters), and Invariants. The primary strategy is to ensure Authorization Independence via Denormalization, which avoids hierarchical authorization dependencies and allows atomic operations.  Structural Segregation is used to maintain a homogeneous security posture within collections.  Access Modeling employs path-based ownership for private user data. The error reported (auth/configuration-not-found) indicates a Firebase configuration issue, not a data structure issue, but I will still provide the data structure according to your requirements. All User-related data will be stored under the /users/{userId} collection to ensure only the user has access to their information unless collaborative features are added in the future which would require membership maps. The user ID is automatically generated upon account creation, allowing data to be secured using rules based on request.auth.uid. This data structure supports QAPs by ensuring clear ownership and access patterns, enabling efficient list operations without compromising security."
  }
}
